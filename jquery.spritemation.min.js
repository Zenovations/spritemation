/*! Spritemation - CSS sprite animator - v0.1.0 - 2012-08-18
* https://github.com/Zenovations/spritemation
* Copyright (c) 2012 Michael 'Kato' Wulf; Licensed MIT, GPL */
(function(a){function b(a){this.first=Math.min(a.start,a.end),this.last=Math.max(a.start,a.end),this.frames=this.last-this.first+1,this.modulate=!!a.modulate,this.maxSteps=this.frames*a.cycles,this.direction=a.start>a.end?-1:1,this.curStep=-1,this.curFrame=this.direction<0?this.last:this.first}function c(a,b,c){return function(d){a.css("background-position",b),d(),c&&c()}}function d(b,c,d){return a.Deferred(function(f){function k(a){j.vertical=a,j.frameWidth||(j.frameWidth=d.innerWidth()),j.frameHeight||(j.frameHeight=d.innerHeight()),j.start===i&&(j.start=h(d,j.frameHeight,j.frameWidth,j.vertical));var b=Math.abs(j.end-j.start)+1;if(j.duration){var e=b*j.cycles;j.modulate&&(e*=2),j.fps=Math.round(e/c*1e3)}g||d.data("spritemation",{frameHeight:j.frameHeight,frameWidth:j.frameWidth,vertical:j.vertical}),f.resolve(j)}var g=d.data("spritemation");b&&typeof b!="object"?b={end:~~b}:b||(b={}),!(c in b)&&typeof c in{number:1,string:1}&&(b.duration=~~c);var i,j=a.extend({start:i,end:0,frameHeight:i,frameWidth:i,vertical:i,fps:30,cycles:1,cycleType:"restart"},g,b);"vertical"in b?k(b.vertical):e(d).then(k)})}function e(b){return a.Deferred(function(c){var d=b.css("background-image");a("<img />").hide().appendTo("body").on("load",function(){c.resolve(a(this).height()>a(this).width()),a(this).remove()}).attr("src",d.substr(5,d.length-7))})}function f(a,b){return[(a.vertical?0:g(a,b,!1))+"px"," ",a.vertical?g(a,b,!0)+"px":0].join("")}function g(a,b,c){return c?a.frameHeight*-b:a.frameWidth*-b}function h(b,c,d,e){var f=b.css("background-position"),g=e?c:d,h=e?2:1,i=f&&f.match(/^(-?[0-9]+(?:px|em|%)?) ?(-?[0-9]+(?:px|em|%)?)?$/);return i?Math.floor(Math.abs(a.UnitConverter.px(b,i[h])/g)):0}function i(a,b,c){return b>c&&(b=b^c,c=b^c,b=b^c),Math.max(b,Math.min(c,a))}a.fn.spritemation=function(e,g){return this.each(function(){var h=a(this).stop("spritemation",!0);d(e,g,h).done(a.proxy(function(d){var e=a(this),g=new b(d);if(d.duration===0||d.start==d.end)e.css("background-position",f(d,d.end)),d.callback&&d.callback(d.end);else{var h,i=1e3/d.fps,j;d.callback&&(j=function(){var a=e.queue("spritemation").length;a===0&&d.callback(h)});while(g.hasNext())h=g.next(),e.queue("spritemation",c(e,f(d,h),j)).delay(i,"spritemation");e.dequeue("spritemation")}},this))})},b.prototype.next=function(){if(this.hasNext()){this.curStep++;if(this.modulate){if(this.direction>0&&this.curFrame===this.last||this.direction<0&&this.curFrame===this.first)this.direction=-this.direction;this.curFrame=this.curFrame+this.direction}else{var a=this.curStep%this.frames;this.direction<0?this.curFrame=this.last-a:this.curFrame=this.first+a}return this.curFrame}return typeof console=="object"&&console.warn&&console.warn("CycleIterator.next() called after last element; that was probably a mistake"),!1},b.prototype.hasNext=function(){return this.curStep<this.maxSteps-1},b.prototype.reset=function(){this.curStep=-1,this.curFrame=this.direction<0?this.last:this.first}})(jQuery);